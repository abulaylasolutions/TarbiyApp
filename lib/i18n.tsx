import React, { createContext, useContext, useState, useMemo, ReactNode, useCallback } from 'react';
import { I18nManager, Platform } from 'react-native';

export type Language = 'it' | 'en' | 'ar';

const translations: Record<Language, Record<string, string>> = {
  it: {
    authLogin: 'Accedi',
    authSignUp: 'Registrati',
    authEmail: 'Email',
    authPassword: 'Password',
    authConfirmPassword: 'Conferma password',
    authTagline: 'Educazione islamica per i tuoi figli',
    authOr: 'oppure',
    authDataSecure: 'I tuoi dati sono al sicuro con noi',
    authEmailPasswordRequired: 'Email e password sono richiesti',
    authPasswordMismatch: 'Le password non corrispondono',
    authPasswordMinLength: 'La password deve avere almeno 6 caratteri',
    authGenericError: 'Si è verificato un errore',
    authSocialNotAvailable: 'richiede la configurazione delle credenziali OAuth. Disponibile nella versione completa.',
    languageLabel: 'Lingua',
    home: 'Home',
    dashboard: 'Dashboard',
    bacheca: 'Bacheca',
    settings: 'Impostazioni',
    hello: 'Salam Alaykum',
    parent: 'Genitore',
    yourChildren: 'I tuoi figli',
    limit: 'Limite',
    noChildrenTitle: 'Nessun figlio aggiunto',
    noChildrenSub: 'Tocca il pulsante + per aggiungere il tuo primo figlio',
    addChild: 'Aggiungi figlio',
    editChild: 'Modifica figlio',
    childName: 'Nome / Soprannome *',
    childNamePlaceholder: 'Nome del bambino',
    birthDate: 'Data di nascita *',
    gender: 'Sesso *',
    male: 'Maschio',
    female: 'Femmina',
    coParent: 'Cogenitore',
    connectCoParent: 'Collega prima un cogenitore nelle Impostazioni',
    cardColor: 'Tema',
    cancel: 'Annulla',
    save: 'Salva',
    delete: 'Elimina',
    deleteConfirm: 'Vuoi eliminare',
    eventDeleted: 'Evento eliminato',
    limitReachedTitle: 'Limite raggiunto',
    limitReachedMsg: 'Con il piano gratuito puoi aggiungere massimo 1 figlio. Passa a Premium per figli illimitati!',
    enterName: 'Inserisci il nome del bambino.',
    invalidDate: 'Inserisci una data di nascita valida.',
    selectGender: 'Seleziona il sesso del bambino.',
    sonOf: 'figlio tuo e di',
    daughterOf: 'figlia tua e di',
    years: 'anni',
    year: 'anno',
    months: 'mesi',
    photoOptional: 'Foto profilo (opzionale)',
    progress: 'Progressi',
    recentActivity: 'Attività Recenti',
    addChildFromHome: 'Aggiungi un figlio dalla Home',
    toViewDashboard: 'per visualizzare la dashboard',
    memorizedSurah: 'Ha memorizzato Surat Al-Fatiha',
    completedDua: 'Completata lezione sulle Du\'a',
    practicedAdab: 'Praticato Adab a tavola',
    example: 'Esempio',
    coParents: 'Cogenitori',
    yourInviteCode: 'Il tuo codice invito',
    copied: 'Copiato!',
    inviteCodeCopied: 'Codice invito copiato negli appunti',
    connectFirstCoParent: 'Collega il primo cogenitore',
    addAnotherCoParent: 'Aggiungi altro cogenitore',
    codeMustBe6: 'Il codice deve essere di 6 caratteri',
    connected: 'Collegato!',
    coParentConnected: 'Cogenitore collegato con successo!',
    code6chars: 'Codice 6 caratteri',
    removeConnection: 'Rimuovi collegamento',
    removeConnectionWith: 'Rimuovere il collegamento con',
    remove: 'Rimuovi',
    dad: 'Papa',
    mom: 'Mamma',
    coParentLabel: 'Cogenitore',
    pendingApprovals: 'Approvazioni in attesa',
    wantsToAdd: 'Vuole aggiungere',
    aChild: 'un figlio',
    general: 'Generale',
    account: 'Account',
    language: 'Lingua',
    plan: 'Piano',
    premium: 'Premium',
    free: 'Gratuito',
    darkMode: 'Modalità notte',
    hijriCalendar: 'Calendario Hijri',
    hijriOn: 'Calendario Hijri',
    hijriOff: 'Calendario Gregoriano',
    calendarTitle: 'Calendario',
    info: 'Info',
    privacy: 'Privacy',
    privacyMsg: 'I tuoi dati sono sincronizzati in modo sicuro.',
    trackRamadan: 'Traccia Ramadan',
    ramadanTracker: 'Ramadan',
    ramadanYear: 'Anno Hijri',
    ramadanProgress: 'Progressi',
    ramadanFasted: 'Digiunato',
    ramadanPartial: 'Parziale',
    ramadanNotTracked: 'Non tracciato',
    ramadanMissed: 'Da recuperare',
    ramadanDays: 'giorni',
    version: 'Versione',
    logout: 'Logout',
    logoutConfirm: 'Vuoi uscire dal tuo account?',
    upgradeTitle: 'Passa a Premium',
    upgradeSub: 'Sblocca funzioni per ogni figlio',
    premiumUnlock: 'Sblocca le funzionalita avanzate per questo figlio',
    premiumTrial: '3 giorni di prova gratuita per figlio',
    premiumFeat1: 'Bacheca condivisa con il cogenitore',
    premiumFeat2: 'Eventi personalizzati illimitati',
    premiumFeat3: 'Memorizzazione Sure del Corano',
    premiumFeat4: 'Figli illimitati (piano famiglia)',
    premiumFeat5: 'Tutte le funzioni future incluse',
    premiumActivated: 'Premium attivato!',
    premiumMonthlyChildMsg: 'Grazie! Figlio sbloccato per 1 mese (demo).',
    premiumAnnualChildMsg: 'Grazie! Figlio sbloccato per 1 anno – risparmi ~46% (demo).',
    premiumAnnualFamilyMsg: 'Grazie! Tutti i figli sbloccati per 1 anno (demo).',
    premiumLifetimeFamilyMsg: 'Grazie! Tutti i figli sbloccati per sempre (demo).',
    premiumTrialMsg: 'Prova gratuita di 3 giorni attivata!',
    monthlyChild: 'Mensile figlio',
    annualChild: 'Annuale figlio',
    annualFamily: 'Annuale famiglia',
    lifetimeFamily: 'Lifetime famiglia',
    monthly: 'Mensile',
    annual: 'Annuale',
    lifetime: 'A vita',
    month: 'mese',
    oneTime: 'una tantum',
    perChild: 'Per 1 figlio',
    allChildren: 'Tutti i figli illimitati',
    allChildrenForever: 'Tutti i figli per sempre',
    save46: '~46%',
    startTrial: 'Prova 3 giorni gratis',
    childPremiumUntil: 'Questo figlio e Premium fino al',
    noChildSelected: 'Seleziona un figlio per gestire Premium',
    restorePurchases: 'Ripristina acquisti',
    restoreTitle: 'Ripristina',
    restoreMsg: 'Nessun acquisto precedente trovato (demo).',
    maybeLater: 'Magari dopo',
    buy: 'Acquista',
    premiumBlockBacheca: 'Sblocca questo figlio con Premium per usare la Bacheca',
    premiumBlockChildren: 'Passa a Premium per figli illimitati',
    premiumBlockEvents: 'Premium richiesto per eventi personalizzati',
    premiumBlockQuran: 'Sblocca per memorizzare le Sure',
    discoverPremium: 'Scopri Premium',
    editNote: 'Modifica',
    noteColor: 'Colore nota',
    editProfile: 'Modifica profilo',
    changPhoto: 'Cambia foto',
    yourName: 'Il tuo nome',
    name: 'Nome',
    invalidBirthDate: 'Data di nascita non valida.',
    selectYourGender: 'Seleziona il genere.',
    enterYourName: 'Inserisci il tuo nome.',
    islamicEducation: 'Educazione islamica per i tuoi figli',
    italian: 'Italiano',
    english: 'English',
    arabic: 'العربية',
    selectLanguage: 'Seleziona lingua',
    bacheca_title: 'Bacheca',
    writeNote: 'Scrivi una nota...',
    noteDetail: 'Dettaglio nota',
    comments: 'Commenti',
    writeComment: 'Scrivi un commento...',
    noComments: 'Nessun commento ancora',
    deleteNote: 'Elimina nota',
    deleteNoteConfirm: 'Vuoi eliminare questa nota?',
    tags: 'Tag',
    todayEvents: 'Eventi di oggi',
    noEventsToday: 'Nessun evento oggi',
    addWithPlus: 'Aggiungi con +',
    addEvent: 'Aggiungi evento',
    eventName: 'Nome evento',
    eventNamePlaceholder: 'Es. Scuola Arabo',
    frequency: 'Frequenza',
    daily: 'Giornaliero',
    weekly: 'Settimanale',
    once: 'Unico',
    editEvent: 'Modifica evento',
    onlyThis: 'Solo questo',
    allFuture: 'Tutti i prossimi',
    applyChangeQuestion: 'Applica solo a questo evento o a tutti i prossimi?',
    deleteRecurringQuestion: 'Elimina solo questo o tutti i prossimi?',
    timePicker: 'Orario',
    today: 'Oggi',
    goToDate: 'Vai a data',
    selectDate: 'Seleziona data',
    confirm: 'Conferma',
    todayActivities: 'Attivita di oggi',
    salahFastingToday: 'Salah e digiuno odierni',
    salahSection: 'Salah',
    fastingSection: 'Digiuno',
    quranReadingSection: 'Lettura Qur\'an',
    quranShort: "Qur'an",
    quranReadingToday: 'Lettura Qur\'an oggi?',
    salahToday: 'Salah di oggi',
    fajr: 'Fajr',
    dhuhr: 'Dhuhr',
    asr: 'Asr',
    maghrib: 'Maghrib',
    isha: 'Isha',
    fastingToday: 'Digiuno oggi?',
    yes: 'Si',
    no: 'No',
    partial: 'Parziale',
    subjects: 'Educazione',
    arabo: 'Arabo',
    quran: "Qur'an",
    akhlaq: "Akhlaq e 'Adab",
    aqidah: 'Aqidah',
    recentActivityLog: 'Attività recenti',
    noActivity: 'Nessuna attività registrata',
    learnedLetters: 'Lettere imparate',
    harakat: 'Harakat',
    canReadArabic: 'Saper leggere',
    canWriteArabic: 'Saper scrivere',
    surahLearnedCount: 'Sure imparate',
    allSurahs: 'Tutte le sure',
    done: 'Fatto',
    notDone: 'Non fatto',
    noteOptional: 'Nota breve...',
    childOf: 'di',
    startTime: 'Orario inizio',
    endTimePicker: 'Orario fine',
    selectDay: 'Seleziona giorno',
    selectDayOfMonth: 'Giorno del mese',
    sun: 'Dom',
    mon: 'Lun',
    tue: 'Mar',
    wed: 'Mer',
    thu: 'Gio',
    fri: 'Ven',
    sat: 'Sab',
    quranMemorization: 'Memorizzazione del Quran',
    surahLearned: 'Imparata',
    surahInProgress: 'In corso',
    surahNotStarted: 'Da imparare',
    surahCount: 'Sure imparate',
    quranToday: "Qur'an oggi?",
    salahTracker: 'Tracker Salah',
    fastingTracker: 'Tracker Digiuno',
    quranTodayTracker: "Tracker Qur'an oggi",
    enabled: 'Attivo',
    disabled: 'Disattivo',
    deleteChild: 'Elimina figlio',
    childSettings: 'Impostazioni figlio',
    moveUp: 'Sposta su',
    moveDown: 'Sposta giu',
    archive: 'Archivio',
    noteArchived: 'Nota archiviata',
    undo: 'Annulla',
    viewArchive: 'Vedi Archivio',
    archivedNotes: 'Note archiviate',
    noArchivedNotes: 'Nessuna nota archiviata',
    unarchive: 'Ripristina',
    prayedFajr: 'Ha pregato Salat Al-Fajr',
    prayedDhuhr: 'Ha pregato Salat Ad-Dhuhr',
    prayedAsr: 'Ha pregato Salat Al-Asr',
    prayedMaghrib: 'Ha pregato Salat Al-Maghrib',
    prayedIsha: 'Ha pregato Salat Al-Isha',
  },
  en: {
    authLogin: 'Login',
    authSignUp: 'Sign Up',
    authEmail: 'Email',
    authPassword: 'Password',
    authConfirmPassword: 'Confirm password',
    authTagline: 'Islamic education for your children',
    authOr: 'or',
    authDataSecure: 'Your data is safe with us',
    authEmailPasswordRequired: 'Email and password are required',
    authPasswordMismatch: 'Passwords do not match',
    authPasswordMinLength: 'Password must be at least 6 characters',
    authGenericError: 'An error occurred',
    authSocialNotAvailable: 'requires OAuth credentials setup. Available in the full version.',
    languageLabel: 'Language',
    home: 'Home',
    dashboard: 'Dashboard',
    bacheca: 'Board',
    settings: 'Settings',
    hello: 'Salam Alaykum',
    parent: 'Parent',
    yourChildren: 'Your children',
    limit: 'Limit',
    noChildrenTitle: 'No children added',
    noChildrenSub: 'Tap the + button to add your first child',
    addChild: 'Add child',
    editChild: 'Edit child',
    childName: 'Name / Nickname *',
    childNamePlaceholder: 'Child\'s name',
    birthDate: 'Date of birth *',
    gender: 'Gender *',
    male: 'Male',
    female: 'Female',
    coParent: 'Co-parent',
    connectCoParent: 'Connect a co-parent first in Settings',
    cardColor: 'Theme',
    cancel: 'Cancel',
    save: 'Save',
    delete: 'Delete',
    deleteConfirm: 'Do you want to delete',
    eventDeleted: 'Event deleted',
    limitReachedTitle: 'Limit reached',
    limitReachedMsg: 'With the free plan you can add max 1 child. Upgrade to Premium for unlimited!',
    enterName: 'Enter the child\'s name.',
    invalidDate: 'Enter a valid date of birth.',
    selectGender: 'Select the child\'s gender.',
    sonOf: 'son of you and',
    daughterOf: 'daughter of you and',
    years: 'years',
    year: 'year',
    months: 'months',
    photoOptional: 'Profile photo (optional)',
    progress: 'Progress',
    recentActivity: 'Recent Activity',
    addChildFromHome: 'Add a child from Home',
    toViewDashboard: 'to view the dashboard',
    memorizedSurah: 'Memorized Surat Al-Fatiha',
    completedDua: 'Completed Du\'a lesson',
    practicedAdab: 'Practiced table manners (Adab)',
    example: 'Example',
    coParents: 'Co-parents',
    yourInviteCode: 'Your invite code',
    copied: 'Copied!',
    inviteCodeCopied: 'Invite code copied to clipboard',
    connectFirstCoParent: 'Connect the first co-parent',
    addAnotherCoParent: 'Add another co-parent',
    codeMustBe6: 'The code must be 6 characters',
    connected: 'Connected!',
    coParentConnected: 'Co-parent connected successfully!',
    code6chars: '6-char code',
    removeConnection: 'Remove connection',
    removeConnectionWith: 'Remove the connection with',
    remove: 'Remove',
    dad: 'Dad',
    mom: 'Mom',
    coParentLabel: 'Co-parent',
    pendingApprovals: 'Pending approvals',
    wantsToAdd: 'Wants to add',
    aChild: 'a child',
    general: 'General',
    account: 'Account',
    language: 'Language',
    plan: 'Plan',
    premium: 'Premium',
    free: 'Free',
    darkMode: 'Dark Mode',
    hijriCalendar: 'Hijri Calendar',
    hijriOn: 'Hijri Calendar',
    hijriOff: 'Gregorian Calendar',
    calendarTitle: 'Calendar',
    info: 'Info',
    privacy: 'Privacy',
    trackRamadan: 'Track Ramadan',
    ramadanTracker: 'Ramadan',
    ramadanYear: 'Hijri Year',
    ramadanProgress: 'Progress',
    ramadanFasted: 'Fasted',
    ramadanPartial: 'Partial',
    ramadanNotTracked: 'Not tracked',
    ramadanMissed: 'To make up',
    ramadanDays: 'days',
    privacyMsg: 'Your data is securely synced.',
    version: 'Version',
    logout: 'Logout',
    logoutConfirm: 'Do you want to log out?',
    upgradeTitle: 'Upgrade to Premium',
    upgradeSub: 'Unlock features per child',
    premiumUnlock: 'Unlock advanced features for this child',
    premiumTrial: '3-day free trial per child',
    premiumFeat1: 'Shared board with co-parent',
    premiumFeat2: 'Unlimited custom events',
    premiumFeat3: 'Quran Surah memorization',
    premiumFeat4: 'Unlimited children (family plan)',
    premiumFeat5: 'All future features included',
    premiumActivated: 'Premium activated!',
    premiumMonthlyChildMsg: 'Thank you! Child unlocked for 1 month (demo).',
    premiumAnnualChildMsg: 'Thank you! Child unlocked for 1 year – save ~46% (demo).',
    premiumAnnualFamilyMsg: 'Thank you! All children unlocked for 1 year (demo).',
    premiumLifetimeFamilyMsg: 'Thank you! All children unlocked forever (demo).',
    premiumTrialMsg: '3-day free trial activated!',
    monthlyChild: 'Monthly per child',
    annualChild: 'Annual per child',
    annualFamily: 'Annual family',
    lifetimeFamily: 'Lifetime family',
    monthly: 'Monthly',
    annual: 'Annual',
    lifetime: 'Lifetime',
    month: 'month',
    oneTime: 'one-time',
    perChild: 'For 1 child',
    allChildren: 'All children unlimited',
    allChildrenForever: 'All children forever',
    save46: '~46%',
    startTrial: 'Try 3 days free',
    childPremiumUntil: 'This child is Premium until',
    noChildSelected: 'Select a child to manage Premium',
    restorePurchases: 'Restore purchases',
    restoreTitle: 'Restore',
    restoreMsg: 'No previous purchases found (demo).',
    maybeLater: 'Maybe later',
    buy: 'Buy',
    premiumBlockBacheca: 'Unlock this child with Premium to use the Board',
    premiumBlockChildren: 'Upgrade to Premium for unlimited children',
    premiumBlockEvents: 'Premium required for custom events',
    premiumBlockQuran: 'Unlock to memorize Surahs',
    discoverPremium: 'Discover Premium',
    editNote: 'Edit',
    noteColor: 'Note color',
    editProfile: 'Edit profile',
    changPhoto: 'Change photo',
    yourName: 'Your name',
    name: 'Name',
    invalidBirthDate: 'Invalid date of birth.',
    selectYourGender: 'Select your gender.',
    enterYourName: 'Enter your name.',
    islamicEducation: 'Islamic education for your children',
    italian: 'Italiano',
    english: 'English',
    arabic: 'العربية',
    selectLanguage: 'Select language',
    bacheca_title: 'Board',
    writeNote: 'Write a note...',
    noteDetail: 'Note detail',
    comments: 'Comments',
    writeComment: 'Write a comment...',
    noComments: 'No comments yet',
    deleteNote: 'Delete note',
    deleteNoteConfirm: 'Do you want to delete this note?',
    tags: 'Tags',
    todayEvents: "Today's events",
    noEventsToday: 'No events today',
    addWithPlus: 'Add with +',
    addEvent: 'Add event',
    eventName: 'Event name',
    eventNamePlaceholder: 'E.g. Arabic School',
    frequency: 'Frequency',
    daily: 'Daily',
    weekly: 'Weekly',
    once: 'Once',
    editEvent: 'Edit event',
    onlyThis: 'Only this',
    allFuture: 'All future',
    applyChangeQuestion: 'Apply only to this event or all future ones?',
    deleteRecurringQuestion: 'Delete only this or all future?',
    timePicker: 'Time',
    today: 'Today',
    goToDate: 'Go to date',
    selectDate: 'Select date',
    confirm: 'Confirm',
    todayActivities: "Today's Activities",
    salahFastingToday: "Today's Salah & Fasting",
    salahSection: 'Salah',
    fastingSection: 'Fasting',
    quranReadingSection: "Qur'an Reading",
    quranShort: "Qur'an",
    quranReadingToday: "Qur'an reading today?",
    salahToday: "Today's Salah",
    fajr: 'Fajr',
    dhuhr: 'Dhuhr',
    asr: 'Asr',
    maghrib: 'Maghrib',
    isha: 'Isha',
    fastingToday: 'Fasting today?',
    yes: 'Yes',
    no: 'No',
    partial: 'Partial',
    subjects: 'Education',
    arabo: 'Arabic',
    quran: "Qur'an",
    akhlaq: "Akhlaq & 'Adab",
    aqidah: 'Aqidah',
    recentActivityLog: 'Recent activity',
    noActivity: 'No activity recorded',
    learnedLetters: 'Letters learned',
    harakat: 'Harakat',
    canReadArabic: 'Can read',
    canWriteArabic: 'Can write',
    surahLearnedCount: 'Surahs learned',
    allSurahs: 'All surahs',
    done: 'Done',
    notDone: 'Not done',
    noteOptional: 'Short note...',
    childOf: 'of',
    startTime: 'Start time',
    endTimePicker: 'End time',
    selectDay: 'Select day',
    selectDayOfMonth: 'Day of month',
    sun: 'Sun',
    mon: 'Mon',
    tue: 'Tue',
    wed: 'Wed',
    thu: 'Thu',
    fri: 'Fri',
    sat: 'Sat',
    quranMemorization: 'Quran Memorization',
    surahLearned: 'Learned',
    surahInProgress: 'In progress',
    surahNotStarted: 'To learn',
    surahCount: 'Surahs learned',
    quranToday: "Qur'an today?",
    salahTracker: 'Salah Tracker',
    fastingTracker: 'Fasting Tracker',
    quranTodayTracker: "Qur'an Today Tracker",
    enabled: 'Enabled',
    disabled: 'Disabled',
    deleteChild: 'Delete child',
    childSettings: 'Child settings',
    moveUp: 'Move up',
    moveDown: 'Move down',
    archive: 'Archive',
    noteArchived: 'Note archived',
    undo: 'Undo',
    viewArchive: 'View Archive',
    archivedNotes: 'Archived notes',
    noArchivedNotes: 'No archived notes',
    unarchive: 'Unarchive',
    prayedFajr: 'Prayed Salat Al-Fajr',
    prayedDhuhr: 'Prayed Salat Ad-Dhuhr',
    prayedAsr: 'Prayed Salat Al-Asr',
    prayedMaghrib: 'Prayed Salat Al-Maghrib',
    prayedIsha: 'Prayed Salat Al-Isha',
  },
  ar: {
    authLogin: 'تسجيل الدخول',
    authSignUp: 'إنشاء حساب',
    authEmail: 'البريد الإلكتروني',
    authPassword: 'كلمة المرور',
    authConfirmPassword: 'تأكيد كلمة المرور',
    authTagline: 'التربية الإسلامية لأطفالك',
    authOr: 'أو',
    authDataSecure: 'بياناتك آمنة معنا',
    authEmailPasswordRequired: 'البريد الإلكتروني وكلمة المرور مطلوبان',
    authPasswordMismatch: 'كلمات المرور غير متطابقة',
    authPasswordMinLength: 'يجب أن تكون كلمة المرور 6 أحرف على الأقل',
    authGenericError: 'حدث خطأ',
    authSocialNotAvailable: 'يتطلب إعداد بيانات OAuth. متاح في النسخة الكاملة.',
    languageLabel: 'اللغة',
    home: 'الرئيسية',
    dashboard: 'لوحة التحكم',
    bacheca: 'اللوحة',
    settings: 'الإعدادات',
    hello: 'السلام عليكم',
    parent: 'ولي الأمر',
    yourChildren: 'أطفالك',
    limit: 'الحد',
    noChildrenTitle: 'لم تتم إضافة أطفال',
    noChildrenSub: 'اضغط على زر + لإضافة طفلك الأول',
    addChild: 'إضافة طفل',
    editChild: 'تعديل الطفل',
    childName: 'الاسم / اللقب *',
    childNamePlaceholder: 'اسم الطفل',
    birthDate: 'تاريخ الميلاد *',
    gender: 'الجنس *',
    male: 'ذكر',
    female: 'أنثى',
    coParent: 'ولي الأمر المشارك',
    connectCoParent: 'قم بربط ولي أمر مشارك أولاً في الإعدادات',
    cardColor: 'الثيم',
    cancel: 'إلغاء',
    save: 'حفظ',
    delete: 'حذف',
    deleteConfirm: 'هل تريد حذف',
    eventDeleted: 'تم حذف الحدث',
    limitReachedTitle: 'تم الوصول إلى الحد',
    limitReachedMsg: 'مع الخطة المجانية يمكنك إضافة طفل واحد فقط. قم بالترقية للحصول على عدد غير محدود!',
    enterName: 'أدخل اسم الطفل.',
    invalidDate: 'أدخل تاريخ ميلاد صالح.',
    selectGender: 'اختر جنس الطفل.',
    sonOf: 'ابنك وابن',
    daughterOf: 'ابنتك وابنة',
    years: 'سنوات',
    year: 'سنة',
    months: 'أشهر',
    photoOptional: 'صورة الملف الشخصي (اختياري)',
    progress: 'التقدم',
    recentActivity: 'النشاط الأخير',
    addChildFromHome: 'أضف طفلاً من الصفحة الرئيسية',
    toViewDashboard: 'لعرض لوحة التحكم',
    memorizedSurah: 'حفظ سورة الفاتحة',
    completedDua: 'أكمل درس الدعاء',
    practicedAdab: 'تدرب على آداب المائدة',
    example: 'مثال',
    coParents: 'أولياء الأمور المشاركون',
    yourInviteCode: 'رمز الدعوة الخاص بك',
    copied: 'تم النسخ!',
    inviteCodeCopied: 'تم نسخ رمز الدعوة',
    connectFirstCoParent: 'اربط ولي الأمر الأول',
    addAnotherCoParent: 'أضف ولي أمر آخر',
    codeMustBe6: 'يجب أن يكون الرمز 6 أحرف',
    connected: 'تم الربط!',
    coParentConnected: 'تم ربط ولي الأمر المشارك بنجاح!',
    code6chars: 'رمز من 6 أحرف',
    removeConnection: 'إزالة الاتصال',
    removeConnectionWith: 'إزالة الاتصال مع',
    remove: 'إزالة',
    dad: 'أب',
    mom: 'أم',
    coParentLabel: 'ولي أمر',
    pendingApprovals: 'الموافقات المعلقة',
    wantsToAdd: 'يريد إضافة',
    aChild: 'طفل',
    general: 'عام',
    account: 'الحساب',
    language: 'اللغة',
    plan: 'الخطة',
    premium: 'مميز',
    free: 'مجاني',
    darkMode: 'الوضع الليلي',
    hijriCalendar: 'التقويم الهجري',
    hijriOn: 'التقويم الهجري',
    hijriOff: 'التقويم الميلادي',
    calendarTitle: 'التقويم',
    info: 'معلومات',
    privacy: 'الخصوصية',
    privacyMsg: 'بياناتك متزامنة بشكل آمن.',
    trackRamadan: 'تتبع رمضان',
    ramadanTracker: 'رمضان',
    ramadanYear: 'السنة الهجرية',
    ramadanProgress: 'التقدم',
    ramadanFasted: 'صام',
    ramadanPartial: 'جزئي',
    ramadanNotTracked: 'غير متتبع',
    ramadanMissed: 'للقضاء',
    ramadanDays: 'أيام',
    version: 'الإصدار',
    logout: 'تسجيل الخروج',
    logoutConfirm: 'هل تريد تسجيل الخروج؟',
    upgradeTitle: 'ترقية إلى مميز',
    upgradeSub: 'افتح الميزات لكل طفل',
    premiumUnlock: 'افتح الميزات المتقدمة لهذا الطفل',
    premiumTrial: '3 أيام تجربة مجانية لكل طفل',
    premiumFeat1: 'لوحة مشتركة مع الشريك',
    premiumFeat2: 'أحداث مخصصة غير محدودة',
    premiumFeat3: 'حفظ سور القرآن',
    premiumFeat4: 'أطفال غير محدودين (خطة عائلية)',
    premiumFeat5: 'جميع الميزات المستقبلية مشمولة',
    premiumActivated: 'تم تفعيل المميز!',
    premiumMonthlyChildMsg: 'شكراً! تم فتح الطفل لمدة شهر (تجريبي).',
    premiumAnnualChildMsg: 'شكراً! تم فتح الطفل لمدة سنة – وفر ~46% (تجريبي).',
    premiumAnnualFamilyMsg: 'شكراً! تم فتح جميع الأطفال لمدة سنة (تجريبي).',
    premiumLifetimeFamilyMsg: 'شكراً! تم فتح جميع الأطفال للأبد (تجريبي).',
    premiumTrialMsg: 'تم تفعيل التجربة المجانية لمدة 3 أيام!',
    monthlyChild: 'شهري للطفل',
    annualChild: 'سنوي للطفل',
    annualFamily: 'سنوي عائلي',
    lifetimeFamily: 'مدى الحياة عائلي',
    monthly: 'شهري',
    annual: 'سنوي',
    lifetime: 'مدى الحياة',
    month: 'شهر',
    oneTime: 'دفعة واحدة',
    perChild: 'لطفل واحد',
    allChildren: 'جميع الأطفال غير محدودين',
    allChildrenForever: 'جميع الأطفال للأبد',
    save46: '~46%',
    startTrial: 'جرب 3 أيام مجاناً',
    childPremiumUntil: 'هذا الطفل مميز حتى',
    noChildSelected: 'اختر طفلاً لإدارة المميز',
    restorePurchases: 'استعادة المشتريات',
    restoreTitle: 'استعادة',
    restoreMsg: 'لم يتم العثور على مشتريات سابقة (تجريبي).',
    maybeLater: 'ربما لاحقاً',
    buy: 'شراء',
    premiumBlockBacheca: 'افتح هذا الطفل مع المميز لاستخدام اللوحة',
    premiumBlockChildren: 'قم بالترقية للحصول على أطفال غير محدودين',
    premiumBlockEvents: 'المميز مطلوب للأحداث المخصصة',
    premiumBlockQuran: 'افتح لحفظ السور',
    discoverPremium: 'اكتشف المميز',
    editNote: 'تعديل',
    noteColor: 'لون الملاحظة',
    editProfile: 'تعديل الملف الشخصي',
    changPhoto: 'تغيير الصورة',
    yourName: 'اسمك',
    name: 'الاسم',
    invalidBirthDate: 'تاريخ ميلاد غير صالح.',
    selectYourGender: 'اختر جنسك.',
    enterYourName: 'أدخل اسمك.',
    islamicEducation: 'التربية الإسلامية لأطفالك',
    italian: 'Italiano',
    english: 'English',
    arabic: 'العربية',
    selectLanguage: 'اختر اللغة',
    bacheca_title: 'اللوحة',
    writeNote: 'اكتب ملاحظة...',
    noteDetail: 'تفاصيل الملاحظة',
    comments: 'التعليقات',
    writeComment: 'اكتب تعليقاً...',
    noComments: 'لا توجد تعليقات بعد',
    deleteNote: 'حذف الملاحظة',
    deleteNoteConfirm: 'هل تريد حذف هذه الملاحظة؟',
    tags: 'العلامات',
    todayEvents: 'أحداث اليوم',
    noEventsToday: 'لا أحداث اليوم',
    addWithPlus: 'أضف بـ +',
    addEvent: 'إضافة حدث',
    eventName: 'اسم الحدث',
    eventNamePlaceholder: 'مثال: مدرسة عربية',
    frequency: 'التكرار',
    daily: 'يومي',
    weekly: 'أسبوعي',
    once: 'مرة واحدة',
    editEvent: 'تعديل الحدث',
    onlyThis: 'هذا فقط',
    allFuture: 'كل القادمة',
    applyChangeQuestion: 'تطبيق فقط على هذا الحدث أم على كل الأحداث القادمة؟',
    deleteRecurringQuestion: 'حذف هذا فقط أم كل الأحداث القادمة؟',
    timePicker: 'الوقت',
    today: 'اليوم',
    goToDate: 'انتقل إلى تاريخ',
    selectDate: 'اختر تاريخ',
    confirm: 'تأكيد',
    todayActivities: 'انشطة اليوم',
    salahFastingToday: 'صلاة وصيام اليوم',
    salahSection: 'الصلاة',
    fastingSection: 'الصيام',
    quranReadingSection: 'قراءة القرآن',
    quranShort: 'القرآن',
    quranReadingToday: 'قراءة القرآن اليوم؟',
    salahToday: 'صلاة اليوم',
    fajr: 'الفجر',
    dhuhr: 'الظهر',
    asr: 'العصر',
    maghrib: 'المغرب',
    isha: 'العشاء',
    fastingToday: 'صيام اليوم؟',
    yes: 'نعم',
    no: 'لا',
    partial: 'جزئي',
    subjects: 'التعليم',
    arabo: 'العربية',
    quran: 'القرآن',
    akhlaq: 'الأخلاق والآداب',
    aqidah: 'العقيدة',
    recentActivityLog: 'النشاط الأخير',
    noActivity: 'لا يوجد نشاط مسجل',
    learnedLetters: 'الحروف المتعلمة',
    harakat: 'الحركات',
    canReadArabic: 'يستطيع القراءة',
    canWriteArabic: 'يستطيع الكتابة',
    surahLearnedCount: 'السور المحفوظة',
    allSurahs: 'جميع السور',
    done: 'تم',
    notDone: 'لم يتم',
    noteOptional: 'ملاحظة قصيرة...',
    childOf: 'من',
    startTime: 'وقت البدء',
    endTimePicker: 'وقت الانتهاء',
    selectDay: 'اختر اليوم',
    selectDayOfMonth: 'يوم الشهر',
    sun: 'أحد',
    mon: 'إثن',
    tue: 'ثلا',
    wed: 'أرب',
    thu: 'خمي',
    fri: 'جمع',
    sat: 'سبت',
    quranMemorization: 'حفظ القرآن',
    surahLearned: 'محفوظة',
    surahInProgress: 'قيد الحفظ',
    surahNotStarted: 'للحفظ',
    surahCount: 'السور المحفوظة',
    quranToday: 'القرآن اليوم؟',
    salahTracker: 'متتبع الصلاة',
    fastingTracker: 'متتبع الصيام',
    quranTodayTracker: 'متتبع القرآن اليومي',
    enabled: 'مفعل',
    disabled: 'معطل',
    deleteChild: 'حذف الطفل',
    childSettings: 'إعدادات الطفل',
    moveUp: 'نقل لأعلى',
    moveDown: 'نقل لأسفل',
    archive: 'الأرشيف',
    noteArchived: 'تم أرشفة الملاحظة',
    undo: 'تراجع',
    viewArchive: 'عرض الأرشيف',
    archivedNotes: 'الملاحظات المؤرشفة',
    noArchivedNotes: 'لا توجد ملاحظات مؤرشفة',
    unarchive: 'إلغاء الأرشفة',
    prayedFajr: 'صلّى صلاة الفجر',
    prayedDhuhr: 'صلّى صلاة الظهر',
    prayedAsr: 'صلّى صلاة العصر',
    prayedMaghrib: 'صلّى صلاة المغرب',
    prayedIsha: 'صلّى صلاة العشاء',
  },
};

interface I18nContextValue {
  lang: Language;
  setLang: (lang: Language) => void;
  t: (key: string) => string;
  isRTL: boolean;
}

const I18nContext = createContext<I18nContextValue | null>(null);

export function I18nProvider({ children }: { children: ReactNode }) {
  const [lang, setLangState] = useState<Language>('en');

  const isRTL = lang === 'ar';

  const setLang = useCallback((newLang: Language) => {
    setLangState(newLang);
    if (Platform.OS !== 'web') {
      I18nManager.forceRTL(newLang === 'ar');
      I18nManager.allowRTL(newLang === 'ar');
    }
  }, []);

  const t = useCallback((key: string): string => {
    return translations[lang]?.[key] || translations.en[key] || key;
  }, [lang]);

  const value = useMemo(() => ({
    lang,
    setLang,
    t,
    isRTL,
  }), [lang, setLang, t, isRTL]);

  return (
    <I18nContext.Provider value={value}>
      {children}
    </I18nContext.Provider>
  );
}

export function useI18n() {
  const context = useContext(I18nContext);
  if (!context) {
    throw new Error('useI18n must be used within an I18nProvider');
  }
  return context;
}

export function getLanguageLabel(lang: Language): string {
  switch (lang) {
    case 'it': return 'Italiano';
    case 'en': return 'English';
    case 'ar': return 'العربية';
  }
}
